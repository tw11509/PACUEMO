require(["main"],function(){require(["config"],function(){require(["modules/PokemonDetail","models/applicationState","domReady!"],function(e,t){e.initialize({model:t})})})}),define("pokemon-detail",function(){}),define("modules/BaseModule",["require"],function(e){var t={initialize:function(e){e=e||{},this.model=e.model,_.bindAll(this);var t=this.model.get("initialized");t?this._initModule():this.model.on("change:initialized",this._initModule)},_initModule:function(){}};return t}),define("views/PageNavigationView",["require","constants/Elements","underscore","backbone","views/BaseView","constants/Layout"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("views/BaseView"),s=e("constants/Layout"),o=i.extend({COLLAPSED_CLASS:"collapsed",EXPANDED_CLASS:"expanded",ANIMATE_OPEN_DURATION:.3,ANIMATE_CLOSED_DURATION:.3,ACTIVE_CLASS:"active",tagName:"ul",className:"page-navigation",events:function(){return Modernizr.touch?{"touchend .toggle div.page-navigation-header":"_onNavigationClick","touchend .subnav li":"_onSubmenuClick"}:{"click .toggle div.page-navigation-header":"_onNavigationClick","click .subnav li":"_onSubmenuClick"}},ui:{},initialize:function(e){e=e||{},n.bindAll(this),this.setElement(t(this.tagName+"."+this.className)),this.bindUIElements()},_onNavigationClick:function(e){var n=t(e.target).closest("li"),r=this.$el.find("li."+this.EXPANDED_CLASS);n.hasClass(this.EXPANDED_CLASS)?this._closeNav(n):(r&&this._closeNav(r),this._openNav(n))},_onSubmenuClick:function(e){var n=t(e.currentTarget);this.$el.find("li."+this.ACTIVE_CLASS).removeClass(this.ACTIVE_CLASS),n.addClass(this.ACTIVE_CLASS)},_closeNav:function(e){Modernizr.csstransitions?e.removeClass(this.EXPANDED_CLASS).addClass(this.COLLAPSED_CLASS):(e.removeClass(this.EXPANDED_CLASS).addClass(this.COLLAPSED_CLASS),TweenMax.to(e.find(".subnav"),this.ANIMATE_OPEN_DURATION,{height:"0","max-height":"0",ease:Cubic.easeOut}))},_openNav:function(e){Modernizr.csstransitions?e.removeClass(this.COLLAPSED_CLASS).addClass(this.EXPANDED_CLASS):(e.removeClass(this.COLLAPSED_CLASS).addClass(this.EXPANDED_CLASS),TweenMax.to(e.find(".subnav"),this.ANIMATE_CLOSED_DURATION,{height:"auto","max-height":"9999px",ease:Cubic.easeOut}))}});return o}),define("widgets/TabSwitcher",["require","jquery"],function(e){var t=e("jquery"),n=function(e,t,n){this.controls=e,this.content=t,this.options=n,this._init()};return n.prototype={VISIBLE_CLASS:"active",_init:function(){this._addEventHandlers()},_swapContent:function(e){var t=this;TweenMax.to(this.content,.25,{opacity:0,onComplete:function(){_(t.content).each(function(n){n.removeClass(t.VISIBLE_CLASS),n.eq(e).addClass(t.VISIBLE_CLASS),TweenMax.to(n.eq(e),.25,{opacity:1})}),t.options&&t.options.onSwapComplete&&t.options.onSwapComplete()}})},_highlightButton:function(e){var t=this.controls.children().length>0?this.controls.children():this.controls;t.removeClass(this.VISIBLE_CLASS),t.eq(e).addClass(this.VISIBLE_CLASS)},_addEventHandlers:function(){var e,n,r=this,i="click";r.options&&r.options.eventType&&(i=r.options.eventType),this.controls.on(i,function(s){s.preventDefault(),i==="click"?(n=t(s.currentTarget),e=t(r.controls).index(n[0])):(n=t(s.currentTarget).find("option:selected"),e=n.val()),r._swapContent(e),r._highlightButton(e)})}},n}),define("views/pokedex/PokemonDetailView",["require","constants/Elements","underscore","backbone","events/UserEvent","views/BaseView","widgets/TabSwitcher","detection/mobileDevice","detection/nintendoDevice","TweenMax","events/TrackingEvent","views/ModalBaseView","utils/websocket"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("events/UserEvent"),s=e("views/BaseView"),o=e("widgets/TabSwitcher"),u=e("detection/mobileDevice"),a=e("detection/nintendoDevice"),f=e("TweenMax"),l=e("events/TrackingEvent"),c=e("views/ModalBaseView"),h=e("utils/websocket"),p=s.extend({ADD_CLASS:"icon_add",ADDED_CLASS:"icon_pokedex_added",el:".pokedex",events:function(){return Modernizr.touch?{"touchstart .moreInfo":"_onMoreInfoClick","touchstart .button-close":"_onCloseButtonClick"}:{"click .moreInfo":"_onMoreInfoClick","click .button-close":"_onCloseButtonClick","click .collectibles-wrapper .collectibles-collection a":"_toggleCollectiblesCollection","click .collectibles-wrapper .collectibles-wishlist a":"_toggleCollectiblesWishlist","click .collectibles-wrapper .collectibles-trade a":"_toggleCollectiblesTrade"}},ui:{detailPanel:".pokemon-ability-info-detail",favoritesButton:"#addToFavorites",formAtributes:".pokedex-pokemon-attributes",formButtons:"#formes",formImages:".profile-images img",formInfo:".pokemon-ability-info",formStats:".pokemon-stats-info",versionButtons:[t("span.version-label.version-x")[0],t("span.version-label.version-y")[0]],versionDescriptions:".version-descriptions p",pokemonNumber:"#pokemonID",gauge:".gauge",activeGauges:".pokemon-stats-info.active .gauge",authRequired:"#pokedex-auth-error-modal"},_addedLabel:null,_number:null,_toggleFavoritesIcon:!0,initialize:function(e){e=e||{},n.bindAll(this),this.bindUIElements();var r=new o(this.ui.formButtons,[this.ui.formAtributes,this.ui.formImages,this.ui.formInfo,this.ui.formStats],{onSwapComplete:this._animateStats,eventType:"change"}),s=new o(this.ui.versionButtons,[this.ui.versionDescriptions]);this._addedLabel=this.ui.favoritesButton.data("added")||"",this._number=this.ui.pokemonNumber.text().replace(/\D/g,""),t.subscribe(i.USER_DETAILS_LOADED,n.bind(this._onUserDetailsLoaded,this)),this.ui.formButtons.on("change",this._gaTrackingFormClick),this._animateStats()},_onUserDetailsLoaded:function(e,r){r.get("isAuthenticated")||(this._modal=new c({el:this.ui.authRequired,shouldCenterVertically:!0}),t.subscribe(i.AUTH_REQUIRED,n.bind(this._modal.open,this._modal)),this._toggleFavoritesIcon=!1),this.compareTrigger=setTimeout(n.bind(function(){if(!h.enabled)return;var e=window.pokemonUI.cookie.get("django_language");h.socket.send(JSON.stringify({pokemon:this._number,locale:e||"en"}))},this),17e4),t.publish("togglesReady")},_showInfoPanel:function(e){e.css({display:"block"}),f.to(e,.2,{opacity:1,ease:Sine.easeInOut})},_closeInfoPanel:function(e){f.to(e,.2,{opacity:0,ease:Sine.easeInOut,onComplete:function(){e.css({display:"none"})}})},_animateStats:function(){var e=this.ui.gauge.find('li:not(".meter")').length/this.ui.gauge.length,r=[];n(this.ui.gauge).each(function(n){var i=t(n).find(".meter"),s=i.data("value"),o=100/(e/s);o=100-o;var u={top:o+"%",ease:Back.easeInOut.config(5)};t(n).closest(".pokemon-stats-info").hasClass("active")?r.push(f.to(i,2,u)):f.set(i,u)});var i=new TimelineMax({paused:!0,align:"normal",stagger:.2,tweens:n.shuffle(r)});u||a?i.seek(10):i.play()},_gaTrackingFormClick:function(e){var n=t(e.target).val();n&&t.publish(l.TRACK,["1.11.1",{label:n}])},_addToFavorites:function(e){var n=e.children("i");this.ui.favoritesButton.off("click",this._onAddToFavoritesClick),e.attr("title",this._addedLabel),this._toggleFavoritesIcon&&(n.removeClass(this.ADD_CLASS),n.addClass(this.ADDED_CLASS)),t.publish(i.ADD_TO_FAVORITES,this._number)},_onMoreInfoClick:function(e){e.preventDefault();var n=t(e.currentTarget),r=n.closest("li").index(),i=n.closest(".pokemon-ability-info").find(".pokemon-ability-info-detail").eq(r);this._showInfoPanel(i)},_onCloseButtonClick:function(e){e.preventDefault();var n=t(e.currentTarget).parent();this._closeInfoPanel(n)},_onAddToFavoritesClick:function(e){e.preventDefault();var r=t(e.currentTarget);return r.removeAttr("rel"),r.trigger("mouseleave"),n.defer(this._addToFavorites,r),!1}});return p}),define("collections/PokedexCollection",["require","constants/Elements","underscore","backbone","models/BaseModel","collections/BaseCollection"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("backbone"),i=e("models/BaseModel"),s=e("collections/BaseCollection"),o=s.extend({SIZES:{height:[["short","medium","tall"],t("body").hasClass("us")?[0,47,83]:[0,1.2,2.1]],weight:[["light","medium","heavy"],t("body").hasClass("us")?[0,99,499]:[0,45,226.3]]},model:i,urlBase:window.pokemonUI.api.pokedex,parse:function(e){var t=this;return n(e).each(function(e){var n=t._convertSize(e.height,"height"),r=t._convertSize(e.weight,"weight");e.height=n,e.weight=r}),e},initialize:function(e){this.options=e||{},this._super(),this.url=this.urlBase+"kalos"},applyFilters:function(e,t){var r=this;return t.length>0&&n(t).each(function(t){e=e.filter(function(e){var i=e.get(t.name);if(typeof i=="object")return n.find(i,function(e){return e=e.toLowerCase(),e===t.value.toLowerCase()});if(t.name==="name")return r._textSearch(e,t);if(t.length>0)return r._sizeFilter(e,t);if(t.value.length>0)return i>=t.value[0]&&i<=t.value[1]})}),e},shuffleItems:function(){return n.shuffle(this.models)},sortItems:function(e){e=e||"Select";var t=this.sortBy(function(t){return e.indexOf("name")>-1?t.get("slug").toLowerCase():t});return e.indexOf("Desc")>-1?t.reverse():t},_textSearch:function(e,t){var n=e.get(t.name);return this._isNumber(t.value)?(n=e.get("id"),n.indexOf(parseFloat(t.value))>-1):n.toLowerCase().indexOf(t.value.toLowerCase())>-1},_sizeFilter:function(e,t){var r=e.get(t[0].name),i=t[0].name,s=0;return n(t).each(function(e){s+=e.value===r}),s},_convertSize:function(e,t){var r=-1;return n(this.SIZES[t][1]).each(function(t){r+=e>t}),this.SIZES[t][0][r]},_isNumber:function(e){return!isNaN(parseFloat(e))}});return o}),define("views/collectibles/TogglesView",["require","constants/Elements","underscore","views/BaseView","models/userModel","events/UserEvent","views/ModalBaseView"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("views/BaseView"),i=e("models/userModel"),s=e("events/UserEvent"),o=e("views/ModalBaseView"),u=r.extend({el:".collectibles-results",toggleInProcess:!1,initialize:function(e){this._super(e),this.collectibleKind=e.collectibleKind||"pokemon";var r=this;t.subscribe(s.USER_DETAILS_LOADED,n.bind(this._onUserDetailsLoaded,this)),t.subscribe("togglesReady",function(){r._onUserDetailsLoaded(),t(".collectibles-wrapper a").on("click",n.bind(r._toggleCollectible,r))}),t.subscribe(s.REMOVE_FROM_FAVORITES,n.bind(r._removeFavorite,this))},ui:{authRequired:"#pokedex-collectible-auth-error-modal"},_authRequired:function(e){this._modal.open()},_onUserDetailsLoaded:function(e){var n=this;if(i.get("isAuthenticated")){var r=i.get("collectibles")[n.collectibleKind],s=i.get("favorites").all,u={have:[],want:[],trade:[]};t("div.collectibles-wrapper").each(function(e,i){t.inArray(t(i).data("collectibles-slug"),r.have)>-1&&(t("a[data-collection=have]",i).addClass("active"),t(i).closest("li.animating").addClass("active")),t.inArray(t(i).data("collectibles-slug"),r.want)>-1&&t("a[data-collection=want]",i).addClass("active"),t.inArray(t(i).data("collectibles-slug"),r.trade)>-1&&t("a[data-collection=trade]",i).addClass("active"),s.indexOf(t(".addToFavorites",i).data("number"))>-1?(t(".addToFavorites",i).removeClass("active").addClass("active"),t(".addToFavorites span",i).removeClass("icon_add icon_pokedex_added").addClass("icon_pokedex_added")):n._addFavoriteEvent()})}this._modal=new o({el:this.ui.authRequired,shouldCenterVertically:!0})},_addFavoriteEvent:function(){t(".collectibles-wrapper .addToFavorites").on("click",function(e){e.preventDefault();var n=t(e.currentTarget);t(e.currentTarget).removeAttr("rel").trigger("mouseleave").off("click").removeAttr("href").removeClass("active").addClass("active").find("span").removeClass("icon_add icon_pokedex_added").addClass("icon_pokedex_added")})},_removeFavorite:function(e){t(".collectibles-wrapper .addToFavorites").removeClass("active").find("span").removeClass("icon_add icon_pokedex_added").addClass("icon_add"),this._addFavoriteEvent()},_toggleCollectible:function(e){e.preventDefault();if(this.toggleInProcess)return;if(t(e.currentTarget).hasClass("addToFavorites")){t.publish(s.ADD_TO_FAVORITES,t(e.currentTarget).data("number"));return}this.toggleInProcess=!0;var n=t(e.currentTarget).data("collection"),r=t(e.currentTarget).closest(".collectibles-wrapper").data("collectibles-slug"),o="https://"+location.hostname+"/api/users/"+(i.get("id")||0)+"/collections/"+n+"/collectibles/"+r+"/kind/"+this.collectibleKind,u=t(e.currentTarget).hasClass("active")?"DELETE":"POST";t.ajax({type:u,url:o,dataType:"json",context:{el:e.currentTarget,slug:r,collection:n,kind:this.collectibleKind,action:u==="POST"?"adding":"deleting",modal:this._modal,self:this}}).done(function(e,r,o){this.action==="adding"?(t(this.el).removeClass("active").addClass("active"),t(this.el).data("collection")==="have"&&t(this.el).closest("li.animating").removeClass("active").addClass("active"),i.addCollectible(this.slug,this.collection,this.kind)):(t(this.el).removeClass("active"),t(this.el).data("collection")==="have"&&t(this.el).closest("li.animating").removeClass("active"),i.removeCollectible(this.slug,this.collection,this.kind));var u=e?e.restrictions:undefined,a=this.action==="adding";if(u){var f=t(this.el).closest(".collectibles-wrapper");for(var l in u.add)n=u.add[l],t("a[data-collection="+n+"]",f).removeClass("active").addClass("active"),i.addCollectible(this.slug,n,this.kind);for(l in u.remove)n=u.remove[l],t("a[data-collection="+n+"]",f).removeClass("active"),i.removeCollectible(this.slug,n,this.kind)}t.publish(s.TOGGLE_COLLECTIBLE,[this.slug,this.collection,this.kind,a,u])}).fail(function(e,t,n){e.status===401&&this.modal.open()}).always(function(){this.self.toggleInProcess=!1})}});return u}),define("templates/collectibles/friends",["handlebars","templates/helpers/each"],function(e){return e.template({1:function(e,t,n,r){var i,s="function",o=t.helperMissing,u=this.escapeExpression;return'    <li class="collectibles-detail-friends-item hidden"\n        data-have="'+u((i=(i=t.have||(e!=null?e.have:e))!=null?i:o,typeof i===s?i.call(e,{name:"have",hash:{},data:r}):i))+'"\n        data-want="'+u((i=(i=t.want||(e!=null?e.want:e))!=null?i:o,typeof i===s?i.call(e,{name:"want",hash:{},data:r}):i))+'"\n        data-trade="'+u((i=(i=t.trade||(e!=null?e.trade:e))!=null?i:o,typeof i===s?i.call(e,{name:"trade",hash:{},data:r}):i))+'">\n      <a href="/us/pokemon-trainer-club/profile/'+u((i=(i=t.screen_name||(e!=null?e.screen_name:e))!=null?i:o,typeof i===s?i.call(e,{name:"screen_name",hash:{},data:r}):i))+'" target="_new">\n        <div class="wrapper"><img src="'+u((i=(i=t.avatar||(e!=null?e.avatar:e))!=null?i:o,typeof i===s?i.call(e,{name:"avatar",hash:{},data:r}):i))+'">\n          <div class="collectible-badge '+u((i=(i=t.hidden||(e!=null?e.hidden:e))!=null?i:o,typeof i===s?i.call(e,{name:"hidden",hash:{},data:r}):i))+'">\n            <div class="active"><span class="icon"></span></div>\n          </div>\n        </div>\n        <span class="name">'+u((i=(i=t.screen_name||(e!=null?e.screen_name:e))!=null?i:o,typeof i===s?i.call(e,{name:"screen_name",hash:{},data:r}):i))+"</span>\n      </a>\n    </li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,r){var i,s,o="function",u=t.helperMissing,a=this.escapeExpression,f='<div class="banner">\n  <h3>'+a((s=(s=t.tradeWithFriends||(e!=null?e.tradeWithFriends:e))!=null?s:u,typeof s===o?s.call(e,{name:"tradeWithFriends",hash:{},data:r}):s))+'</h3>\n  <p class="can-trade hidden">'+a((s=(s=t.canTrade||(e!=null?e.canTrade:e))!=null?s:u,typeof s===o?s.call(e,{name:"canTrade",hash:{},data:r}):s))+'</p>\n  <p class="cant-trade hidden">'+a((s=(s=t.cannotTrade||(e!=null?e.cannotTrade:e))!=null?s:u,typeof s===o?s.call(e,{name:"cannotTrade",hash:{},data:r}):s))+'</p>\n	<ul class="collectibles-detail-friends-list">\n';return i=t.each.call(e,e!=null?e.friends:e,{name:"each",hash:{},fn:this.program(1,r),inverse:this.noop,data:r}),i!=null&&(f+=i),f+"  </ul>\n</div>\n\n"},useData:!0})}),define("views/collectibles/FriendsView",["require","constants/Elements","underscore","views/BaseView","models/userModel","events/UserEvent","templates/collectibles/friends"],function(e){var t=e("constants/Elements"),n=e("underscore"),r=e("views/BaseView"),i=e("models/userModel"),s=e("events/UserEvent"),o=e("templates/collectibles/friends"),u=r.extend({el:".collectibles-detail-friends",template:o,allCollectibleClasses:"collectibles-collection collectibles-wishlist collectibles-trade hidden",allIconClasses:"icon-collection icon-wishlist icon-trade",initialize:function(e){this._super(e),this.collectibleKind=e.collectibleKind||"pokemon";if(t(".collectibles-detail-friends").length===0)return;this.collectiblesSlug=window.pokemonUI.collectiblesSlug,this.userCollectibles={},t.subscribe(s.USER_DETAILS_LOADED,n.bind(this._onUserDetailsLoaded,this))},render:function(e){var n=i.get("friends"),r=[];for(var s=0;s<n.length;++s){var o=n[s].collectibles[this.collectibleKind],u={screen_name:n[s].screen_name,avatar:n[s].avatar,hidden:"hidden",have:t.inArray(this.collectiblesSlug,o.have)>-1,want:t.inArray(this.collectiblesSlug,o.want)>-1,trade:t.inArray(this.collectiblesSlug,o.trade)>-1};(u.have||u.want||u.trade)&&r.push(u)}var a={tradeWithFriends:window.pokemonUI.collectibles.friends.tradeWithFriends,canTrade:window.pokemonUI.collectibles.friends.canTrade,cannotTrade:window.pokemonUI.collectibles.friends.cannotTrade,noFriends:window.pokemonUI.collectibles.friends.noFriends,friends:r};this.$el.append(this.template(a)),this._updateFriends()},_onUserDetailsLoaded:function(e){if(i.get("isAuthenticated")){var r=i.get("collectibles")[this.collectibleKind],o=this;t("div.collectibles-wrapper").each(function(e,n){o.userCollectibles[t(n).data("collectibles-slug")]={have:t.inArray(t(n).data("collectibles-slug"),r.have)>-1,want:t.inArray(t(n).data("collectibles-slug"),r.want)>-1,trade:t.inArray(t(n).data("collectibles-slug"),r.trade)>-1}}),t.subscribe(s.TOGGLE_COLLECTIBLE,n.bind(this._updateFriends,this)),this.render()}},_updateFriends:function(e,n,r,i,s,o){this.userCollectibles=this.userCollectibles||{};var u=this.userCollectibles[this.collectiblesSlug],a=this.allCollectibleClasses,f=this.allIconClasses;if(n&&r&&s!==undefined){this.userCollectibles[n][r]=s;if(o){for(var l in o.add)this.userCollectibles[n][o.add[l]]=!0;for(l in o.remove)this.userCollectibles[n][o.remove[l]]=!1}}t(".collectibles-detail-friends-item").each(function(e,n){var r;u.want&&t(n).data("trade")?r="trade":u.want&&t(n).data("have")?r="collection":(u.have||u.trade)&&t(n).data("want")&&(r="wishlist"),r?(t(".collectible-badge",n).removeClass(a).addClass("collectibles-"+r),t(".icon",n).removeClass(f).addClass("icon_"+r),t(n).removeClass("hidden")):(t(n).removeClass("hidden").addClass("hidden"),t(".collectible-badge",n).addClass("hidden"))}),u&&(u.have||u.want||u.trade)?(t(".can-trade").removeClass("hidden"),t(".cant-trade").removeClass("hidden").addClass("hidden")):(t(".cant-trade").removeClass("hidden"),t(".can-trade").removeClass("hidden").addClass("hidden"))}});return u}),define("modules/PokemonDetail",["require","jquery","underscore","modules/BaseModule","views/PageNavigationView","views/pokedex/PokemonDetailView","collections/PokedexCollection","views/collectibles/TogglesView","views/collectibles/FriendsView"],function(e){var t=e("jquery"),n=e("underscore"),r=e("modules/BaseModule"),i=e("views/PageNavigationView"),s=e("views/pokedex/PokemonDetailView"),o=e("collections/PokedexCollection"),u=e("views/collectibles/TogglesView"),a=e("views/collectibles/FriendsView"),f=n.extend(r,{_initModule:function(){t(".container").addClass("pokedex"),this._addViews()},_addViews:function(){var e=new i({el:".page-navigation"}),t=new s,n=new a({collectibleKind:"pokemon"}),r=new u({collectibleKind:"pokemon"})}});return f});